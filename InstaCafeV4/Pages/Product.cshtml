@page "{name}"
@model ProductModel
@{
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/bulma@0.9.2/css/bulma.min.css,npm/bulma@0.9.2/css/bulma.min.css"> 

<section class="home-slider owl-carousel">

    <div class="slider-item" style="background-image: url(~/Images/bg_3.jpg);" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row slider-text justify-content-center align-items-center">

                <div class="col-md-7 col-sm-12 text-center ftco-animate">
                    <h1 class="mb-3 mt-5 bread">Product Detail</h1>
                    <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home</a></span> <span>Product Detail</span></p>
                </div>

            </div>
        </div>
    </div>
</section>

<section class="ftco-section">
    <div class="container">
        <div class="row">

            <div class="col-lg-6 mb-5 ftco-animate">

                @if (Model.Product.Name == "Apple Pie")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/apple-pie.jpg);"></a>

                }
                @if (Model.Product.Name == "Ice Cream")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/ice-cream.jpg);"></a>

                }
                @if (Model.Product.Name == "Potato Pudding")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/potato-pudding.jpg);"></a>

                }

                @if (Model.Product.Name == "Orange Juice")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/drink-1.jpg);"></a>

                }
                @if (Model.Product.Name == "Sorrel Juice")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/drink-8.jpg);"></a>

                }
                @if (Model.Product.Name == "Soda")
                {
                    <a class="menu-img img mb-4" style="background-image: url(images/soda.jpg);"></a>
                }
                @if (Model.Product.Name == "Grilled Cheese Sandwich")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/burger-3.jpg);"></a>

                }
                @if (Model.Product.Name == "Mock Chicken")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/mock-chicken.jpg);"></a>

                }
                @if (Model.Product.Name == "Sorrel Sauce Tipplets in Lentil Rice")
                {

                    <a class="menu-img img mb-4" style="background-image: url(images/tipplets.jpg);"></a>


                }
            </div>
            <div class="col-lg-6 product-details pl-md-5 ftco-animate">
                
                    <h3>@Model.Product.Name</h3>
                    <p class="price"><span>@Model.Product.Price</span></p>

                    <p>
                        @Model.Product.Description
                    </p>
                    <div class="row mt-4">
                        <form method="post" id="form1">
                            <div class="col-md-6">

                                <div class="field-body">
                                    <div class="field is-narrow">
                                        <div class="control">
                                            <div class="select is-fullwidth">
                                                <select asp-for="CartViewModel.StockId" onchange="toggleStock(event)">
                                                    @foreach (var s in Model.Product.Stock)
                                                    {
                                                        bool disabled = s.Quantity <= 0;

                                                        <option value="@s.Id" disabled="@disabled">@s.Description</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            <div class="w-100"></div>
                            <div class="input-group col-md-6 d-flex mb-3">
                                <span class="input-group-btn mr-2">

                                </span>
                                <input class="form-control input-number" asp-for="CartViewModel.Quantity" value="1" />
                                @foreach (var stock in Model.Product.Stock)
                                {
                                    if (stock.Quantity <= 10)
                                    {
                                        <p class="help is-danger is-hidden low-stock" id="low-stock-@stock.Id">
                                            @(stock.Quantity == 0 ? "Out Stock" : $"{stock.Quantity} Left")
                                        </p>
                                    }
                                }
                                <span class="input-group-btn ml-2">

                                </span>
                            </div>
                            <p><a class="btn btn-primary py-3 px-5" onclick="document.getElementById('form1').submit();" >Add to Cart</a></p>
                        </form>

                    </div>
                    
                
            </div>
        </div>
    </div>
</section>




<script>
    var toggleStock = function (e) {
        console.log(e);

        var stockToHide = document.querySelectorAll('.low-stock')

        stockToHide.forEach(function (e) {
            e.classList.add('is-hidden');
        })

        showLowStock(e.target.value);
    }

    var showLowStock = function (id) {
        var stockToShow = document.getElementById('low-stock-' + id);

        if (stockToShow !== null && stockToShow !== undefined)
            stockToShow.classList.remove('is-hidden');
    }

    showLowStock(document.getElementById('CartViewModel_StockId').value);
</script>